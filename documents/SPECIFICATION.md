# 仕様書

## 1. 概要

Notionのドキュメントを取得し、はてなブログの形式に変換して新規記事として投稿するコマンドラインツール。

## 2. 機能

-   指定されたNotionページのコンテンツとタイトルを取得する。
-   Notionのブロック形式をMarkdownに変換する。
-   変換後のコンテンツをはてなブログに投稿する。
    -   デフォルトでは下書きとして投稿する。
    -   コマンドラインオプションで公開投稿も可能。
    -   CDATAセクションを利用してHTMLタグがエスケープされるのを防ぐ。
-   APIキーやIDを `.env` ファイルで安全に管理する。
-   Notionの画像は、はてなフォトライフにアップロードして永続的なURLに変換する。
-   ロギング機能を追加し、処理の進捗やエラーを出力する。
-   NotionのURLからページIDを抽出し、ID形式を検証する。
-   リンク、ブックマーク、リンクプレビュー、埋め込みをはてなブログの適切な埋め込み形式に変換する。
-   コールアウトをCSSで装飾されたHTMLに変換する。
    -   **注:** この機能を利用するには、別途はてなブログのデザインCSSを設定する必要があります。
-   環境変数 (`NOTION_API_KEY`, `HATENA_API_KEY`, `HATENA_USER_ID`, `HATENA_BLOG_ID`) が設定されていない場合、またはNotionページID/URLが不正な場合に、具体的なエラーメッセージを表示してユーザーに通知する。

## 3. コマンドラインインターフェース

```bash
# GUIモード (引数なし)
python main.py
```

-   **実行:** 実行ボタン押下で処理を開始。バックグラウンドスレッドで実行され、完了またはエラー時に結果や詳細なエラーメッセージをダイアログで表示する。

## 5. 対応するNotionブロック

-   見出し 1, 2, 3
-   段落
-   箇条書きリスト
-   番号付きリスト
-   コードブロック
-   引用
-   画像
-   ブックマーク
-   リンク
-   リンクプレビュー
-   埋め込み
-   コールアウト
-   テーブル

## 5. 環境変数

以下の変数を `.env` ファイルに設定する必要がある。

-   `NOTION_API_KEY`: Notionインテグレーションのトークン。
-   `HATENA_API_KEY`: はてなブログのAPIキー。
-   `HATENA_USER_ID`: はてなID。
-   `HATENA_BLOG_ID`: はてなブログのID。

## 6. ライセンス

このプロジェクトはMITライセンスのもとで公開されています。詳細は `LICENSE` ファイルを参照してください。

## 7. その他

- `.gitignore` に `.ruff_cache` を追加し、不要なキャッシュファイルがバージョン管理されるのを防ぐ。

## 8. 配布形式

- **スタンドアロン実行ファイル:** PyInstaller を使用して、Python 環境がない Windows 環境でも実行可能な exe ファイルを生成可能。
    - **設定ファイル:** `.env` ファイルを実行ファイルと同じディレクトリに配置することで設定を読み込む。