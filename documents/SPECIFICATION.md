# 仕様書

## 1. 概要

Notionのドキュメントを取得し、はてなブログの形式に変換して新規記事として投稿するコマンドラインツール。

## 2. 機能

-   指定されたNotionページのコンテンツとタイトルを取得する。
-   Notionのブロック形式をMarkdownに変換する。
-   変換後のコンテンツをはてなブログに投稿する。
    -   デフォルトでは下書きとして投稿する。
    -   コマンドラインオプションで公開投稿も可能。
    -   CDATAセクションを利用してHTMLタグがエスケープされるのを防ぐ。
-   APIキーやIDを `.env` ファイルで安全に管理する。
-   Notionの画像は、はてなフォトライフにアップロードして永続的なURLに変換する。
-   ロギング機能を追加し、処理の進捗やエラーを出力する。
-   NotionのURLからページIDを抽出し、ID形式を検証する。
-   リンク、ブックマーク、リンクプレビュー、埋め込みをはてなブログの適切な埋め込み形式に変換する。
-   コールアウトをCSSで装飾されたHTMLに変換する。
    -   **注:** この機能を利用するには、別途はてなブログのデザインCSSを設定する必要があります。
-   環境変数 (`NOTION_API_KEY`, `HATENA_API_KEY`, `HATENA_USER_ID`, `HATENA_BLOG_ID`) が設定されていない場合、またはNotionページID/URLが不正な場合に、具体的なエラーメッセージを表示してユーザーに通知する。

## 3. ユーザーインターフェースの切り替え

実行時のコマンドライン引数によって、インターフェースが自動的に切り替わる。

- **GUIモード**: 引数なしで実行した場合。PySide6ベースのウィンドウが起動する。
- **CLIモード**: 第一引数にNotionのURLまたはIDを渡した場合。標準出力にログを表示しながら処理を行う。

## 4. GUI仕様

- **フレームワーク:** PySide6
- **入力:** NotionページURLまたはIDを入力するテキストボックス。
- **オプション:** 「公開して投稿」を選択するチェックボックス（デフォルトはOFFで下書き）。
- **実行:** 実行ボタン押下で処理を開始。
- **エラーハンドリング:** 
    - `NOTION_API_KEY` のチェックは、実行ボタン押下時に行われる。
    - 環境変数の欠落や不正な入力に対しては、詳細なエラーメッセージを含む `QMessageBox.critical` ダイアログを表示する。

## 8. 配布形式

- **スタンドアロン実行ファイル:** PyInstaller を使用して生成された `dist/notion-to-hatena.exe`。
    - **提供形態:** リポジトリの `dist` ディレクトリ内にビルド済みの実行ファイルを同梱。
    - **設定ファイル:** `.env` ファイルを実行ファイルと同じディレクトリに配置することで設定を読み込む。

    - **動作:** スクリプト実行時と同様に、引数の有無でGUI/CLIを切り替えることが可能。